<div ng-controller="usuariosCtrl as vm">
    <div class="row wrapper border-bottom white-bg page-heading">
        <div class="col-lg-10">
            <h2>Suministros</h2>
            <ol class="breadcrumb">
                <li>
                    <a href="/Home/Index" target="_self">Home</a>
                </li>
                <li class="active">
                    <strong>Suministros</strong>
                </li>
            </ol>
        </div>
        <div class="col-lg-2">

        </div>
    </div>
    <div class="wrapper wrapper-content animated fadeInRight">
        <div class="row">
            <div class="col-sm-8">
                <div class="ibox">
                    <div class="ibox-title">
                        <h5>Listado de Suministros</h5>
                        <div class="ibox-tools">
                            <button ng-if="vm.session.idPerfil==1 || vm.session.idPerfil==2" type="button"  class="btn btn-primary btn-xs" ng-click="vm.excelSuministro()"><i class="fa fa-file-excel-o"></i> Descargar Excel</button>
                            <a href="" class="btn btn-primary btn-xs" ng-click="vm.openCreateSuministro()"><i class="fa fa-plus"></i> Crear suministro</a>
                        </div>
                    </div>
                    <div class="ibox-content" style="height: 83rem;">
                        

                        <div class="clients-list col-sm-12">
                            <div class="tab-content">
                                <div id="tab-1" class="tab-pane active" style="height: 100%">
                                    <div class="full-height-scroll" full-scroll>
                                        <div class="table-responsive">
                                            <table class="table table-striped table-hover" st-table="vm.suministros_disp" st-safe-src="vm.suministros">
                                                <thead>
                                                <tr>
                                                    <th colspan="8">
                                                        <div class="input-group" style="width: 100%">
                                                            <input st-search type="text" placeholder="Buscar.... " class="input form-control" ng-model="vm.search">
                                                            <span class="input-group-btn">
                                                                <button type="button" class="btn btn btn-primary"> <i class="fa fa-search"></i> Buscar</button>
                                                            </span>
                                                        </div>
                                                        <span class="pull-right small text-muted m-t-sm">{{vm.suministros_disp.length}} Suministro<span ng-if="vm.suministros_disp.length!=1">s</span></span>
                                                    </th>
                                                </tr>
                                                </thead>
                                                <tbody>
                                                <tr ng-repeat="c in vm.suministros_disp | filter:vm.search" ng-click="vm.suministroSelected = c;vm.loadServicios(c);vm.loadTareas(c);vm.loadFilesSuministro(c)" ng-class="{'text-danger':c.baja}">
                                                    <td class="client-status" style="width: 2rem"><span class="label" ng-class="{'label-success':c.idtipo==1,'label-info':c.idtipo==2}">{{c.tipo}}</span></td>
                                                    <td><a class="client-link">{{c.cups}}<br/><small class="text-capitalize">{{c.cliente}}</small></a></td>
                                                    <td class="contact-type"><i class="fa fa-calendar"> </i></td>
                                                    <td> {{c.fecha_alta | jsonDate:'dd-MM-yyyy'}}</td>
                                                    <td class="contact-type"><i class="fa fa-user"> </i></td>
                                                    <td> {{c.comercial}}<span ng-if="vm.session.idPerfil==1"><br/><small>{{c.empresa}}</small></span></td>
                                                    <td class="client-status"><span class="label" ng-class="{'label-primary':c.idestado==2,'label-danger':c.idestado==3}">{{c.estado}}</span></td>
                                                    <td class="client-status"><span class="label" ng-class="{'label-primary':c.idestado_back==1,'label-danger':c.idestado_back==2,'label-info':c.idestado_back==3,'label-warning':c.idestado_back==4}">{{c.estado_back}}</span></td>
                                                </tr>
                                                </tbody>
                                                <tfoot>
                                                <tr>
                                                    <td colspan="8" class="text-center">
                                                        <div st-pagination="" st-items-by-page="10" st-displayed-pages="10"></div>
                                                    </td>
                                                </tr>
                                                </tfoot>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
            <div class="col-sm-4">
                <div class="ibox ">
                    <div class="ibox-content">
                        <div class="tab-content">
                            <div id="contact-1" class="tab-pane active" ng-if="vm.suministroSelected!=undefined">
                                <div class="row m-b-lg">
                                    <div class="col-lg-12 text-center" ng-class="{'text-danger':vm.suministroSelected.baja==1}">
                                        <small>{{vm.suministroSelected.tipo}}</small>
                                        <h3>{{vm.suministroSelected.cups}}</h3>
                                        <div ng-if="vm.suministroSelected.baja==1">
                                            {{vm.suministroSelected.motivo_baja}}<br />
                                            {{vm.suministroSelected.fecha_baja | jsonDate:'dd-MM-yyyy'}}<br /><br />
                                        </div>
                                    </div>
                                    <div class="col-lg-7">
                                        <i class="fa fa-map-marker" ng-if="vm.suministroSelected.direccion!=''"></i> {{vm.suministroSelected.direccion}}<br />
                                        {{vm.suministroSelected.nompoblacion}}<br />
                                        {{vm.suministroSelected.nomprovincia}}<br />
                                        {{vm.suministroSelected.cp}}<br />
                                    </div>
                                    <div class="col-lg-5">
                                        <button type="button" class="btn btn-primary btn-sm btn-block" ng-click="vm.openDetail(vm.suministroSelected)">
                                            <i class="fa fa-eye"></i> Ver
                                        </button>
                                         <button type="button" class="btn btn-primary btn-sm btn-block" ng-click="vm.openEditSuministro(vm.suministroSelected)">
                                            <i class="fa fa-pencil"></i> Editar
                                        </button>
                                        <button type="button" class="btn btn-primary btn-sm btn-block" ng-click="vm.openAddTarea(vm.suministroSelected)">
                                            <i class="fa fa-hacker-news"></i> Añadir tarea
                                        </button>
                                    </div>
                                </div>
                                <div class="client-detail">
                                    <div class="full-height-scroll" full-scroll>
                                        <div class="row">

                                            <span class="col-md-6" ng-if="vm.suministroSelected.idtarifa!=-1">
                                                <label>Tarifa</label><br />
                                                {{vm.suministroSelected.tarifa}}<br />
                                            </span>
                                            <span class="col-md-6">
                                                <label>Potencia</label><br />
                                                {{vm.suministroSelected.potencia}}<br />
                                            </span>
                                            <span class="col-md-6" ng-if="vm.suministroSelected.idrango!=-1">
                                                <label>Rango de Potencia</label><br />
                                                {{vm.suministroSelected.rango}}<br />
                                            </span>
                                            <span class="col-md-6" ng-if="vm.suministroSelected.idoferta!=-1">
                                                <label>Oferta</label><br />
                                                {{vm.suministroSelected.oferta}}<br />
                                            </span>
                                            <span class="col-md-6" ng-if="vm.suministroSelected.potencia>15">
                                                <span class="col-md-3"><label>P1</label><br />{{vm.suministroSelected.p1}}</span>
                                                <span class="col-md-3"><label>P2</label><br />{{vm.suministroSelected.p2}}</span>
                                                <span class="col-md-3"><label>P3</label><br />{{vm.suministroSelected.p3}}</span>
                                            </span>
                                            <span class="col-md-6" ng-if="vm.suministroSelected.idaaff!=-1">
                                                <label>Admin. de fincas</label><br />
                                                {{vm.suministroSelected.aaff}}<br />
                                            </span>
                                            <span class="col-md-6" ng-if="vm.suministroSelected.idorigen!=-1">
                                                <label>Origen</label><br />
                                                {{vm.suministroSelected.origen}}<br />
                                            </span>
                                            <span class="col-md-6" ng-if="vm.suministroSelected.num_parte.length">
                                                <label>Nº Parte</label><br />
                                                {{vm.suministroSelected.num_parte}}<br />
                                            </span>
                                            <div class="col-md-6">
                                                <label>NNSS</label>
                                                <div class="checkbox checkbox-primary" style="margin-top: 0">
                                                    <input type="checkbox" ng-model="vm.suministroSelected.nnss" ng-true-value="1" ng-false-value="0" disabled>
                                                    <label>&nbsp;</label>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label>ZAR</label>
                                                <div class="checkbox checkbox-primary" style="margin-top: 0">
                                                    <input type="checkbox" ng-model="vm.suministroSelected.zar" ng-true-value="1" ng-false-value="0" disabled>
                                                    <label>&nbsp;</label>
                                                </div>
                                            </div>
                                        </div>
                                        <label>Servicios</label>
                                        <ul class="list-group clear-list">
                                            <li class="list-group-item" ng-repeat="l in vm.suministroSelected.servicios" ng-class="{'fist-item':$first}">
                                                {{l.servicio}}
                                            </li>
                                        </ul>
                                        <label>Documentos</label>
                                        <ul class="list-group clear-list">
                                            <p ng-repeat="f in vm.suministroSelected.files"><a class="text-primary" ng-href="../../subidas/suministros/{{vm.suministroSelected.id}}/{{f.fichero}}" target="_blank"><i class="fa" ng-class="vm.iconFile(f.extension)"></i> {{f.fichero}}</a></p>
                                        </ul>
                                        <label>Observaciones</label>
                                        <div class="col-md-12">
                                            <p>{{vm.suministroSelected.observaciones}}</p>
                                        </div>
                                        <hr />
                                        <label>Tareas</label>
                                        <div class="col-md-12 m-t-md table-responsive">
                                            
                                            <table class="table table-hover issue-tracker">
                                                <tbody>
                                                <tr ng-if="vm.suministroSelected.tareas.length==0">
                                                    <td><h5>No existen tareas</h5></td>
                                                </tr>
                                                <tr ng-repeat="t in vm.suministroSelected.tareas">
                                                    <td>
                                                        <span class="label" ng-class="{'label-primary':t.finalizado==0,'label-danger':t.finalizado==1}">{{t.paso+1}}</span>
                                                    </td>
                                                    <td class="issue-info" style="width: 44%">
                                                        <a href="#" ng-click="vm.openEditTarea(t,vm.suministroSelected)">
                                                            {{t.nombre}}
                                                        </a>
                                                    </td>
                                                    <td>
                                                        <span class="label label">{{t.estado}}</span>
                                                    </td>
                                                </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
	</div>


@section scripts {
    @Scripts.Render("~/bundles/usuarios/js")
}
